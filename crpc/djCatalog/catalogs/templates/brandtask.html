{% extends 'base.html' %}
{% block body %}
	<div class='navbar'>
		<div class='navbar-inner'>
			<div>
				<ul class="nav nav-pills">
				  <li class="active">
				    <a class='brand' href="#">Brands Monitor</a>
				  </li>
				  <li><a href="/admin">admin</a></li>
				</ul>
				

			</div>

		</div>
	</div>
	<div>
		<ul class="nav nav-pills">
		  {% if tab == 'unextracted' %}
		  <li class="active">
		  {% else %}
		  <li>{% endif %}
		    <a href="/monitor/brand/tasks?brand_complete=False">unextracted</a>
		  {% if tab == 'extracted' %}
		  <li class="active">
		  {% else %}
		  <li>{% endif %}
		  	<a href="/monitor/brand/tasks?brand_complete=True">extracted</a></li>
		</ul>
	</div>
    <div class='row-fluid'>
    	<div class='span12'>
    		<div class='container-fluid'>
				<table class="table table-striped table-bordered table-condensed">
					<thead>
						<tr>
							<th>title</th>
							<th>brand</th>
							<th>favbuy_brand</th>
							<th>site</th>
							<th>doctype</th>
							<th>key</th>
							<th>url</th>
							<th>created_at</th>
							<th>updated_at</th>
							<th>brand_complete</th>
							<th>is_checked</th>
						</tr>
					</thead>
					<tbody>
						{% for task in tasks %}
							<tr id='{{ task.pk }}'>
								<td>{{ task.title }}</td>
								<td>{{ task.brand }}</td>
								<td>{{ task.favbuy_brand }}</td>
								<td>{{ task.site }}</td>
								<td>{{ task.doctype }}</td>
								<td>{{ task.key }}</td>
								<td><a href="{{ task.url }}">{{ task.url }}</a></td>
								<td>{{ task.created_at }}</td>
								<td>{{ task.updated_at }}</td>
								<td>
									<select class='sel_brand_complete'>
										<option value='{{ task.brand_complete }}'>{{ task.brand_complete }}</option>
										{% if task.brand_complete %}
										<option value='False'>False</option>
										{% else %}
										<option value='True'>True</option>
										{% endif %}
									</select>
								</td>
								<td>
									<select class='sel_checked'>
										<option value='{{ task.is_checked }}'>{{ task.is_checked }}</option>
										{% if task.is_checked %}
										<option value='False'>False</option>
										{% else %}
										<option value='True'>True</option>
										{% endif %}
									</select>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
    		</div>
    	</div>
    </div>
	<div class="pagination">
	  <ul>
	    <li><a href="#">前一页</a></li>
	    <li class="active">
	      <a href="#">1</a>
	    </li>
	    <li><a href="#">2</a></li>
	    <li><a href="#">3</a></li>
	    <li><a href="#">4</a></li>
	    <li><a href="#">后一页</a></li>
	  </ul>
	</div>

{% load static %}
<script src={% static "js/jquery-1.8.3.min.js" %}></script>
<script type="text/javascript">
$('.sel_brand_complete').change(function(){
	var pk = $(this).parent().parent().attr('id');
	var url = "/monitor/brand/task/"+pk+"/";
	$.post(url, {'brand_complete': $(this).val()}, function(data){
		data = JSON.parse(data);
		title = data.code ? 'failed: ' : 'succeed: '
		alert(title+data.message);
	}).error(function(err){
		alert(err.responseText);
	});
});

$('.sel_checked').change(function(){
	var pk = $(this).parent().parent().attr('id');
	var url = "/monitor/brand/task/"+pk+"/";
	$.post(url, {'is_checked': $(this).val()}, function(data){
		data = JSON.parse(data);
		title = data.code ? 'failed: ' : 'succeed: '
		alert(title+data.message);
	}).error(function(err){
		alert(err.responseText);
	});
});
</script>
{% endblock %}